
//     while (retries < MAX_RETRIES) {
//       try {
//         const chunkStream = fs.createReadStream(chunkPath);
//         await new Promise((resolve, reject) => {
//           chunkStream.pipe(writeStream, { end: false });
//           chunkStream.on('end', resolve);
//           chunkStream.on('error', reject);
//         });
//         console.log(`Chunk ${i} merged successfully`);
//         await fs.promises.unlink(chunkPath);
//         console.log(`Chunk ${i} deleted successfully`);
//         break; // Success, move to next chunk
//       } catch (error) {
//         if (error.code === 'EBUSY') {
//           console.log(
//             `Chunk ${i} is busy, retrying... (${retries + 1}/${MAX_RETRIES})`
//           );
//           await delay(RETRY_DELAY);
//           retries++;
//         } else {
//           throw error; // Unexpected error, rethrow
//         }
//       }
//     }

//     if (retries === MAX_RETRIES) {
//       console.error(`Failed to merge chunk ${i} after ${MAX_RETRIES} retries`);
//       writeStream.end();
//       throw new Error(`Failed to merge chunk ${i}`);
//     }
//   }

//   writeStream.end();
//   console.log('Chunks merged successfully');
// }
// router.use((err, req, res, next) => {
//   if (err instanceof multer.MulterError) {
//     console.log('Multer error:', err.message);
//     return res.status(400).json({ error: err.message });
//   }
//   if (err) {
//     fs.readdir(uploadPathChunks, (err, files) => {
//       if (err) {
//         return console.error('Unable to scan directory: ' + err);
//       } 
  
//       // Iterate over the files and delete each one
//       files.forEach(file => {
//         const filePath = path.join(uploadPathChunks, file);
  
//         fs.promises.unlink(filePath, err => {
//           if (err) {
//             console.error('Error deleting file:', filePath, err);
//           } else {
//             console.log('Successfully deleted file:', filePath);
//           }
//         });
//       });
//     });
//     console.log('General error:', err.message);
//     return res.status(500).json({ error: err.message });
//   }
//   next();
// });
// // export const  uploadMulter = (store)=>{
// //     return multer({storage:store})
// // }

// // export {storage}
//.....................................................
